<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P√°gina con Mapa Leaflet</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Estilos del encabezado */
        header {
            display: flex;
            align-items: center;
            background-color: #0D0D0D;
            color: white;
            padding: 5px 30px;
            z-index: 1001; /* Encabezado por encima */
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        header img {
            height: 35px;
        }

        h1 {
            font-size: 20px;
            margin-left: 20px;
        }

        /* Barra de filtros */
        .filters-bar {
            background-color: #333333;
            display: flex;
            justify-content: center;
            padding: 10px 0;
            position: relative;
            z-index: 1001; /* Barra siempre sobre el mapa */
        }

        .filter {
            margin: 0 15px;
            position: relative; /* Necesario para dropdown */
        }

        /* Bot√≥n desplegable */
        .dropbtn {
            background-color: #555555;
            color: white;
            padding: 8px 16px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .dropbtn:hover {
            background-color: #777777;
        }

        /* Contenedor del men√∫ */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
            border-radius: 4px;
            z-index: 9999; /* üëà Fuerza sobre el mapa */
        }

        /* Opciones dentro del men√∫ */
        .dropdown-content a {
            color: black;
            padding: 10px 14px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #ddd;
        }

        /* Mostrar men√∫ al pasar el mouse */
        .filter:hover .dropdown-content {
            display: block;
        }

        /* Mapa */
        #map {
            flex: 2; 
            height: 100%;
        }

        /* üîπ Evitar que los pol√≠gonos muestren recuadro negro al hacer clic */
        .leaflet-interactive:focus {
            outline: none !important;
        }

        /* Descripci√≥n */
        .description {
            flex: 1; 
            padding: 20px;
            background-color: #f4f4f4;
            overflow-y: auto;
            border-left: 1px solid #ccc;
        }

        /* Contenedor de mapa y descripci√≥n */
        .container {
            display: flex;
            height: calc(100vh - 120px); /* Resta header y barra */
        }

        button {
            padding: 8px 16px;
            font-size: 14px;
            background-color: #444444;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Encabezado -->
    <header>
        <div class="logo-container">
            <img src="imagenes/mapa.png" alt="Logo">
        </div>
        <h1>Bosque Popular</h1>
    </header>

    <!-- Barra de Filtros -->
    <div class="filters-bar">
        <!-- Dropdown de Equipamientos -->
        <div class="filter">
            <button class="dropbtn">Equipamientos</button>
            <div class="dropdown-content">
                <a href="parques.html">Parques</a>
                <a href="movilidad.html">Movilidad</a>
                <a href="vias.html">V√≠as</a>
            </div>
        </div>

        <div class="filter">
            <button class="dropbtn">Problem√°ticas</button>
            <div class="dropdown-content">
                <a href="calidadaire.html">Calidad del aire</a>
            </div>
        </div>

        <div class="filter">
            <button class="dropbtn">Acerca de m√≠</button>
            <div class="dropdown-content">
                <a href="descripcion.html">Descripci√≥n</a>
                <a href="ubicacion.html">Ubicaci√≥n</a>
                <a href="catastro3d.html">Catastro 3D</a>
            </div>
        </div>
    </div>

    <!-- Contenedor para el mapa y la descripci√≥n -->
    <div class="container">
        <!-- Mapa Leaflet -->
        <div id="map"></div>

        <!-- Descripci√≥n -->
        <div class="description">
            <h2>Parques</h2>
            <p>El barrio Bosque Popular cuenta con tres parques vecinales: El Tr√©bol, La Estrella del Sur y Bosque Popular. </p>
            <p>Haga click sobre cada parque para obtener m√°s informaci√≥n. </p>
        </div>
    </div>

    <!-- Scripts de Leaflet -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Crear el mapa
        const map = L.map('map').setView([4.670473643688381, -74.09632602920297], 17);
    
        // Agregar capa de mapa base
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
    
        // Descripci√≥n general
        const descripcionGeneral = `
            <h2>Parques</h2>
            <p>El barrio Bosque Popular cuenta con tres parques vecinales: El Tr√©bol, La Estrella del Sur y Bosque Popular.</p>
            <p>Haga click sobre cada parque para obtener m√°s informaci√≥n.</p>
        `;
    
        // Diccionario con descripciones e im√°genes
        const parquesInfo = {
            "Parque El Tr√©bol": {
                descripcion: "Este parque es un punto de encuentro comunitario con zonas verdes y juegos infantiles.",
                imagen: "imagenes/PElTrebol.jpg"
            },
            "Parque La Estrella del Sur": {
                descripcion: "Un parque vecinal con amplias zonas deportivas y espacios de recreaci√≥n.",
                imagen: "imagenes/PLaEstrellaDelSur.jpg"
            },
            "Parque Bosque Popular": {
                descripcion: "El parque m√°s grande del barrio, rodeado de √°rboles y senderos para caminar.",
                imagen: "imagenes/PBosquePopular.jpg"
            }
        };
    
        // üå≥ √çcono de √°rbol verde
        const treeIcon = L.icon({
            iconUrl: "https://cdn-icons-png.flaticon.com/512/427/427735.png",
            iconSize: [32, 32],
            iconAnchor: [16, 32]
        });
    
        // Funci√≥n para actualizar descripci√≥n lateral
        function actualizarDescripcion(nombre) {
            const info = parquesInfo[nombre];
            if (info) {
                document.querySelector('.description').innerHTML = `
                    <h2>${nombre}</h2>
                    <p>${info.descripcion}</p>
                    <img src="${info.imagen}" alt="${nombre}" style="width:100%;border-radius:8px;margin-top:10px;">
                `;
            } else {
                document.querySelector('.description').innerHTML = descripcionGeneral;
            }
        }
    
        // Variables globales
        let capaSeleccionada = null;
        let marcadorSeleccionado = null;
        let geojsonLayer; // üëà ahora es global
    
        // Cargar el GeoJSON
        fetch('parques.geojson')
            .then(response => response.json())
            .then(data => {
                geojsonLayer = L.geoJSON(data, {
                    style: {
                        color: "blue",
                        weight: 2,
                        fillColor: "transparent",
                        fillOpacity: 0.3
                    },
                    onEachFeature: function (feature, layer) {
                        const nombre = feature.properties.nombre;
                        const centroide = layer.getBounds().getCenter();
    
                        // Crear marcador
                        const marker = L.marker(centroide, { icon: treeIcon })
                            .addTo(map)
                            .on('click', () => seleccionarParque(layer, marker, nombre));
    
                        // Tooltip en hover
                        layer.bindTooltip(nombre, { permanent: false, sticky: true });
    
                        // Click en pol√≠gono
                        layer.on('click', () => seleccionarParque(layer, marker, nombre));
                    }
                }).addTo(map);
    
                // Evento para clic fuera de pol√≠gonos ‚Üí reset
                map.on('click', function (e) {
                    if (!e.originalEvent.target.closest('.leaflet-interactive')) {
                        resetSeleccion();
                        actualizarDescripcion(null);
                    }
                });
            });
    
        // Selecci√≥n de parque
        function seleccionarParque(layer, marker, nombre) {
            // Resetear selecci√≥n anterior
            resetSeleccion();
    
            // Resaltar pol√≠gono
            layer.setStyle({
                color: "green",
                fillColor: "lightgreen",
                fillOpacity: 0.6
            });
    
            // Guardar selecci√≥n
            capaSeleccionada = layer;
            marcadorSeleccionado = marker;
    
            // Animar marcador (salto infinito)
            let baseLatLng = marker.getLatLng();
            let offset = 0;
            let direction = 1;
            let anim = setInterval(() => {
                offset += 0.00005 * direction;
                if (offset > 0.0003 || offset < 0) direction *= -1;
                marker.setLatLng([baseLatLng.lat + offset, baseLatLng.lng]);
            }, 50);
    
            // Guardar animaci√≥n en marker
            marker._anim = anim;
    
            // Actualizar descripci√≥n lateral
            actualizarDescripcion(nombre);
        }
    
        // Reset de selecci√≥n
        function resetSeleccion() {
            if (capaSeleccionada) {
                geojsonLayer.resetStyle(capaSeleccionada);
                capaSeleccionada = null;
            }
            if (marcadorSeleccionado) {
                clearInterval(marcadorSeleccionado._anim); // üëà detener animaci√≥n
                marcadorSeleccionado.setLatLng(marcadorSeleccionado.getLatLng()); // volver al lugar original
                marcadorSeleccionado = null;
            }
        }
    </script>
    
</body>
</html>
